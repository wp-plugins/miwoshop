/**
* Copyright 2011 Amazon.com, Inc., or its Affiliates.
**/

function isIphone(){var B=navigator.userAgent;var A=/iPhone/i.test(B);var C=/iPhone OS 6/i.test(B);return(A&&!(C))}if(!CBA||typeof (CBA)=="undefined"){var CBA={}}if(!CBA.Widgets||typeof (CBA.Widgets)=="undefined"){CBA.Widgets={};CBA.jQuery=jQuery.noConflict(true);CBA.Widgets.createSubclass=function(A){function B(){}B.prototype=A;return new B()};CBA.Metrics=function(){CBA.Metrics.prototype.constructor=CBA.Metrics};CBA.Metrics.Collector=function(){CBA.Metrics.Collector.prototype.constructor=CBA.Metrics.Collector;this.COUNTERS_KEY="counters";this.TIMING_KEY="timing";this.START_KEY="start";this.profileData=new Object();this.profileData[this.COUNTERS_KEY]=new Array();this.profileData[this.TIMING_KEY]=new Array();this.id=(new Date()).getTime()};CBA.Metrics.Collector.TimingSection=function(A){CBA.Metrics.Collector.TimingSection.prototype.constructor=CBA.Metrics.Collector.TimingSection;this.SECTION_NAME_KEY="sectionName";this.DATAPOINT_NAME_KEY="name";this.DATAPOINT_TIME_KEY="time";this.SECTION_KEY="section";this.DATA_KEY="data";this.sectionName=A;this.data=new Array();this.startDate=new Date()};CBA.Metrics.Collector.TimingSection.prototype.registerTimedEvent=function(A){this.registerTimedEventWithTime(A,this.startDate.getTime())};CBA.Metrics.Collector.TimingSection.prototype.registerTimedEventWithTime=function(C,B){if(typeof (C)!=="undefined"&&C!=null&&typeof (B)!=="undefined"&&B!=null){var A=new Object();A[this.DATAPOINT_NAME_KEY]=C;A[this.DATAPOINT_TIME_KEY]=B;this.data.push(A)}};CBA.Metrics.Collector.TimingSection.prototype.toJSON=function(){var A="{";A+="'"+this.SECTION_KEY+"' : '"+this.sectionName+"', ";A+="'"+this.DATA_KEY+"' : [";var C=1;var B=this.data;CBA.jQuery.each(B,function(){A+="{ '"+this.name+"' : '"+this.time+"'}";if(C<B.length){A+=","}C++});A+="] }";return A};CBA.Metrics.Collector.prototype.publish=function(){var B=encodeURIComponent(this.toJSON());var A=CBA.Widgets.Constants.WIDGET_ENDPOINT+CBA.Widgets.Constants.CSM_URI+B;CBA.Widgets.Utilities.addScriptNodetoBody({"id":this.id,"URI":A})};CBA.Metrics.Collector.prototype.startTimingSection=function(A){if(typeof (A)!=="undefined"&&A!=null){var B=new CBA.Metrics.Collector.TimingSection(A);B.registerTimedEvent(this.START_KEY);this.profileData[this.TIMING_KEY].push(B)}};CBA.Metrics.Collector.prototype.startTimingSectionWithTime=function(A,B){if(typeof (A)!=="undefined"&&A!=null&&typeof (B)!=="undefined"&&B!=null){var C=new CBA.Metrics.Collector.TimingSection(A);C.registerTimedEventWithTime(this.START_KEY,B);this.profileData[this.TIMING_KEY].push(C)}};CBA.Metrics.Collector.prototype.registerTime=function(A,B){if(typeof (B)!=="undefined"&&B!=null){CBA.jQuery.each(this.profileData[this.TIMING_KEY],function(){var C=this;if(typeof (C)!=="undefined"&&typeof (C.sectionName)!=="undefined"&&C.sectionName===A){C.registerTimedEvent(B);return false}})}};CBA.Metrics.Collector.prototype.addCounter=function(A){if(typeof (A)!=="undefined"&&A!=null){this.profileData[this.COUNTERS_KEY].push(A);return true}return false};CBA.Metrics.Collector.prototype.toJSON=function(){var B="{";var E=this.profileData[this.TIMING_KEY];if(typeof (E)!=="undefined"&&E!=null){B+="'"+this.TIMING_KEY+"' : [";var D=1;var A=CBA.jQuery.each(E,function(){B+=this.toJSON();if(D<E.length){B+=","}D++;return true});B+="],"}var C=this.profileData[this.COUNTERS_KEY];if(typeof (C)!=="undefined"&&C!=null){B+="'"+this.COUNTERS_KEY+"' : [";D=1;CBA.jQuery.each(C,function(){B+="'"+this+"'";if(D<C.length){B+=","}D++});B+="]"}B+="}";return B};CBA.Widgets.mainCollector=new CBA.Metrics.Collector();CBA.Widgets.mainCollector.startTimingSectionWithTime("js-loading",CBA.ZERO_TIME);CBA.Widgets.Constants={};CBA.Widgets.Constants.POPUP_WIN_WIDTH=520;CBA.Widgets.Constants.POPUP_WIN_HEIGHT=475;CBA.Widgets.Constants.POPUP_WIN_NAME="CBAPopupWindow";CBA.Widgets.Constants.AP_LOGO_IMG="https://images-na.ssl-images-amazon.com/images/G/02/cba/images/logos/logo_amazonpayments_overlay.gif";CBA.Widgets.Constants.AP_CONDITIONS_LINK="TBD";CBA.Widgets.Constants.AP_CONDITIONS_STRING="TBD";CBA.Widgets.Constants.AP_PRIVACY_LINK="TBD";CBA.Widgets.Constants.AP_PRIVACY_STRING="TBD";CBA.Widgets.Constants.LOADING_IMAGE_GIF="https://images-na.ssl-images-amazon.com/images/G/02/ui/loadIndicators/loading-small_labeled.gif";CBA.Widgets.Constants.COMMON_CSS=" <style>         a {color:#004B91;}        #headerSlots {padding-top: 0; height: 50px;}        #footerSlots {width: 100%;height: 50px;position: fixed;bottom: 0px;left: 0px;}        #footerSlots #amazonPaymentsLogo {background: url("+CBA.Widgets.Constants.AP_LOGO_IMG+") no-repeat center top;margin-top: 4px;height: 17px;text-indent: -9999px;}        #footerSlots .AtoZ {font-size: 10px; padding-top: 1px;}        #footerSlots .ap_privacy_info {font-size: 9px;}        div#bottom-6 {left:auto;top:auto;text-align: center;border-top:1px solid #B3B3B3;}        .ap_privacy_info {font-family:Verdana;font-size:10px;font-weight:normal;}    </style> ";CBA.Widgets.Constants.COMMON_LOADING_HTML="     	<div id='pageLoading'>           <div id='wrapper'>             <div id='headerSlots'></div>             <div id='mainContentArea'>                 <div id='centerSlots'>                     <div id='center-1'>                         <div id='imgLoading'>                             <img id='loadingImg' src='"+CBA.Widgets.Constants.LOADING_IMAGE_GIF+"'>                        </div>                     </div>                 </div>             </div>             <div id='footerSlots'>                 <div id='bottom-6'>                    <div class='amazonPaymentLogo' id='amazonPaymentsLogo'></div>                 </div>            </div>        </div>    </div>";CBA.Widgets.Constants.POPUP_LOADING_HTML=CBA.Widgets.Constants.COMMON_CSS+"<style>  #pageLoading #mainContentArea {height: 375px;overflow-y: auto;} #imgLoading {text-align: center; padding-top: 120px;} </style>"+CBA.Widgets.Constants.COMMON_LOADING_HTML;CBA.Widgets.Constants.LOADING_HTML=CBA.Widgets.Constants.COMMON_CSS+"<style>  #pageLoading #mainContentArea {height:100%;overflow-y: hidden;} #imgLoading { width:100%; height:100% ;text-align: center; padding-top: 120px;} </style>"+CBA.Widgets.Constants.COMMON_LOADING_HTML;CBA.Widgets.Constants.WIDGET_ENDPOINT="https://payments.amazon.co.uk";CBA.Widgets.Constants.BUTTON_ENDPOINT="https://payments.amazon.co.uk";CBA.Widgets.Constants.CHECKOUT_WORKFLOW="v2";CBA.Widgets.Constants.BUTTON_URI="/gp/cba/button";CBA.Widgets.Constants.STANDARD_CHECKOUT_URI="/gp/cba/"+CBA.Widgets.Constants.CHECKOUT_WORKFLOW+"/ofp";CBA.Widgets.Constants.EXPRESS_CHECKOUT_URI="/gp/cba/v2/express";CBA.Widgets.Constants.INLINE_WIDGETS_URI="/gp/cba/v2/widgets";CBA.Widgets.Constants.PRIME_WIDGETS_URI="/gp/cba/v2/prime";CBA.Widgets.Constants.BRIDGE_WIDGET_URI="/gp/cba/v2/widgets?action=bridge";CBA.Widgets.Constants.CartOwnerId="";CBA.Widgets.Constants.JSONP_URI="/gp/cba/jsonp?action=";CBA.Widgets.Constants.CSM_URI="/gp/cba/csm/jsonp?data=";CBA.Widgets.Constants.BRIDGE_IFRAME_NAME="CBABridgeIframe";CBA.Widgets.Constants.WIDGETID_PREFIX="CBAWidgets";CBA.Widgets.Constants.WIDGETID_PARAM_NAME=";widgetId=";CBA.Widgets.Constants.TIMER_INTERVAL=100;CBA.Widgets.Constants.DOCUMENT_LOAD_COMPLETED=false;CBA.Widgets.Constants.PURCHASE_CONTRACT_ID_COOKIE_NAME="apay-pcId";CBA.Widgets.Constants.PURCHASE_CONTRACT_ID_COOKIE_LIFETIME=3;CBA.Widgets.Constants.ADDRESS_WIDGET={READ:{"min_width":150,"max_width":600,"default_width":400,"min_height":180,"max_height":400,"default_height":180},EDIT:{"min_width":280,"max_width":600,"default_width":400,"min_height":230,"max_height":400,"default_height":230}};CBA.Widgets.Constants.WALLET_WIDGET={READ:{"min_width":150,"max_width":600,"default_width":400,"min_height":180,"max_height":400,"default_height":180},EDIT:{"min_width":280,"max_width":600,"default_width":400,"min_height":230,"max_height":400,"default_height":230}};CBA.Widgets.Constants.ORDER_DETAIL_WIDGET={RENDER:{"min_width":392,"max_width":600,"default_width":392,"min_height":310,"max_height":400,"default_height":310},OPEN:{"min_width":422,"max_width":422,"default_width":422,"min_height":340,"max_height":340,"default_height":340}};CBA.Widgets.Constants.CASHBACK_BUTTON_VERSION=11231982;CBA.Widgets.Constants.IS_CASHBACK_BUTTON_SHOWN=(typeof (__cba__buttonversion)!="undefined"&&__cba__buttonversion==CBA.Widgets.Constants.CASHBACK_BUTTON_VERSION);CBA.Widgets.Constants.CBA_REGION_HEIGHT_RATIO=0.78;CBA.Widgets.Config={};CBA.Widgets.Config.POLL_FOR_EVENTS=true;CBA.Widgets.WidgetTypes={"StandardCheckoutWidget":"StandardCheckoutWidget","ExpressCheckoutWidget":"ExpressCheckoutWidget","InlineCheckoutWidget":"InlineCheckoutWidget","AddressWidget":"AddressWidget","WalletWidget":"WalletWidget","OrderDetailsWidget":"OrderDetailsWidget"};CBA.Widgets.ButtonTypes={"STANDARD_CHECKOUT":"cart","EXPRESS_CHECKOUT":"expressCheckout","INLINE_CHECKOUT":"inlineCheckout","INLINE_ADDRESS":"addressBook"};CBA.Widgets.ButtonRegions={"CBA_REGION":"cbaRegion"};CBA.Widgets.CartOrigins={"CartPage":"CartPage","DetailPage":"DetailPage"};CBA.Widgets.DisplayModes={"read":"read","edit":"edit"};CBA.Widgets.OrderInputFormats={"HTML":"HTML","XML":"XML"};CBA.Widgets.PaymentInstrumentsDisplayOptions={"ShowAll":"ShowAll","Default":"Default"};CBA.Widgets.EventTypes={"DOCUMENT_READY":"CBA.DocumentReadyEvent","REFRESH":"apay-refresh","WIDGET_REFRESH":"apay-widgetrefresh;widgetId=","EXPRESS_CHK_ONAUTHORIZE":"apay-pcId=","ON_ADDRESS_SELECT":"apay-addressselect;widgetId=","ON_PAYMENT_SELECT":"apay-paymentselect;widgetId=","ON_CLOSE":"apay-close;widgetId=","ON_PPH_WIDGET_CLOSE":"apay-close","PRIME_WIDGET_RESIZE":"apay-prime-resize;widgetId=","ON_ERROR":"apay-cba_mec_","REDIRECT_URL":"apay-redirectUrl;widgetId="};CBA.Widgets.TaskQueue=function(){this.taskQueue=new Array()};CBA.Widgets.TaskQueue.prototype.push=function(A){this.taskQueue.push(A)};CBA.Widgets.TaskQueue.prototype.pop=function(){return this.taskQueue.length>0?this.taskQueue.shift():null};CBA.Widgets.TaskQueue.prototype.isEmpty=function(){return(this.taskQueue.length===0)};CBA.Widgets.Task=function(){};CBA.Widgets.Task.prototype.execute=function(){};CBA.Widgets.Task.WidgetRenderFormTask=function(B,A){CBA.Widgets.Task.call(this);this.formId=B;this.data=A};CBA.Widgets.Task.WidgetRenderFormTask.prototype=CBA.Widgets.createSubclass(CBA.Widgets.Task.prototype);CBA.Widgets.Task.WidgetRenderFormTask.prototype.constructor=CBA.Widgets.Task.WidgetRenderFormTask;CBA.Widgets.Task.WidgetRenderFormTask.prototype.execute=function(){CBA.jQuery(this.data).appendTo("body");CBA.jQuery("#"+this.formId).submit()};CBA.Widgets.Mediator=function(){this.widgetCount=0;this.registry=new Object()};CBA.Widgets.Mediator.prototype.generateUniqWidgetID=function(){return this.widgetCount++};CBA.Widgets.Mediator.prototype.getNumWidgetCount=function(){return this.widgetCount};CBA.Widgets.Mediator.prototype.register=function(A){this.registry[A.getID()]=A};CBA.Widgets.Mediator.prototype.notifyListeners=function(B){for(var A in this.registry){var C=this.registry[A];C.eventValue=B.eventValue;C.errorCode=B.errorCode;CBA.jQuery(C).trigger(B.eventName,C)}};CBA.Widgets.mediator=new CBA.Widgets.Mediator();CBA.Widgets.taskQueue=new CBA.Widgets.TaskQueue();CBA.jQuery(document).ready(function(){CBA.Widgets.Constants.DOCUMENT_LOAD_COMPLETED=true;if(!CBA.Widgets.Utilities.isValidDocInclusion()){return }window.setTimeout(CBA.Widgets.Utilities.pollTaskQueue,CBA.Widgets.Constants.TIMER_INTERVAL);for(var B in CBA.Widgets.mediator.registry){var C=CBA.Widgets.mediator.registry[B];CBA.jQuery(C).trigger(CBA.Widgets.EventTypes.DOCUMENT_READY,C)}if(CBA.Widgets.Config.POLL_FOR_EVENTS){setInterval(CBA.Widgets.Utilities.pollEvents,CBA.Widgets.Constants.TIMER_INTERVAL)}if(typeof (window.postMessage)!="undefined"){if(window.addEventListener){window.addEventListener("message",CBA.Widgets.Utilities.handleMessage,false)}else{if(window.attachEvent){window.attachEvent("onmessage",CBA.Widgets.Utilities.handleMessage)}}}CBA.Widgets.Utilities.setupJsonp(CBA.Widgets.Constants.CartOwnerId,"checkCashback");CBA.Widgets.Utilities.setupBridgeIframe();var A=CBA.Widgets.mediator.getNumWidgetCount();if(A===0){CBA.Widgets.V1.processMerchantPage()}CBA.Widgets.mainCollector.publish()});CBA.Widgets.Mobile=new (function(){var B=navigator.userAgent.toLowerCase();var A=new Array("iphone","ipod","series60","symbian","android","windows ce","blackberry","palm");this.isMobile=function(){for(var C=0;C<A.length;C++){var D=A[C];if(B.search(D)>-1){return true}}return false}});CBA.Widgets.Utilities=function(){};CBA.Widgets.Utilities.JsonpActions={"CHECK_CASHBACK_ACTION":"CheckCashback","V1_UPGRADE_ACTION":"v1upgrade"};CBA.Widgets.Utilities.isFF=function(){return navigator.userAgent.match(/Firefox/i)};CBA.Widgets.Utilities.isWin=function(){return navigator.userAgent.match(/Windows/i)};CBA.Widgets.Utilities.flashVersion=function(){var A;if(!navigator.plugins||(navigator.plugins.length<1)){return }try{var F=navigator.plugins.length;for(var C=0;C<F;C++){var E=navigator.plugins[C];if(E.name.match(/Shockwave Flash/)){if(E.version){A=E.version}else{var B=E.description.match(/([0-9.]+)\s+r([0-9.]+)/);A=B&&(B[1]+"."+B[2])}}}}catch(D){}return A};CBA.Widgets.Utilities.CheckCashbackJsonpHandler=function(A){if(A.buttonVersion!==null&&typeof (A.buttonVersion)!=="undefined"){__cba__buttonversion=A.buttonVersion;CBA.Widgets.Constants.IS_CASHBACK_BUTTON_SHOWN=(typeof (__cba__buttonversion)!="undefined"&&__cba__buttonversion==CBA.Widgets.Constants.CASHBACK_BUTTON_VERSION)}};CBA.Widgets.Utilities.V1UpgradeJsonpHandler=function(A){if(A.status!==null&&typeof (A.status)!=="undefined"){CBA.Widgets.V1.Constants.allowV2=A.status}};CBA.Widgets.Utilities.JsonpMap=new Object();CBA.Widgets.Utilities.JsonpMap[CBA.Widgets.Utilities.JsonpActions.CHECK_CASHBACK_ACTION]=CBA.Widgets.Utilities.CheckCashbackJsonpHandler;CBA.Widgets.Utilities.JsonpMap[CBA.Widgets.Utilities.JsonpActions.V1_UPGRADE_ACTION]=CBA.Widgets.Utilities.V1UpgradeJsonpHandler;CBA.Widgets.Browser=function(){};CBA.Widgets.Browser.isSafari2=function(){var C=CBA.jQuery.browser.version;var B=C.match("419")!==null?C.match("419").length>0:false;var A=((CBA.jQuery.browser.safari)&&B);return A};CBA.Widgets.Browser.isIE=function(){return CBA.jQuery.browser.msie};CBA.Widgets.Browser.isIE8=function(){var B=CBA.jQuery.browser.version;var C=B.match("8.0")!==null?B.match("8.0").length>0:false;var A=(CBA.Widgets.Browser.isIE()&&C);return A};CBA.Widgets.Utilities.openPopUp=function(E){if(CBA.Widgets.Utilities.flashVersion()&&CBA.Widgets.Utilities.isWin()&&CBA.Widgets.Utilities.isFF()){var A=document.getElementById("cba-swf-container");if(!A){A=document.createElement("div");A.setAttribute("id","cba-swf-container");document.body.appendChild(A);dummyswf=document.createElement("object");dummyswf.setAttribute("style","visibility:hidden");dummyswf.setAttribute("type","application/x-shockwave-flash");dummyswf.setAttribute("data","");dummyswf.setAttribute("width","0");dummyswf.setAttribute("height","0");A.appendChild(dummyswf)}}var D=(window.screen.width-CBA.Widgets.Constants.POPUP_WIN_WIDTH)/2;var C=(window.screen.height-CBA.Widgets.Constants.POPUP_WIN_HEIGHT)/2;var G="top="+C+",left="+D+",width="+CBA.Widgets.Constants.POPUP_WIN_WIDTH+",height="+CBA.Widgets.Constants.POPUP_WIN_HEIGHT+", resizable=yes,menubar=no,toolbar=no";if(CBA.jQuery.browser.safari||CBA.jQuery.browser.msie){G=G+",location=yes,status=yes"}var F=window.open("",E,G);try{F.document.write(CBA.Widgets.Constants.POPUP_LOADING_HTML)}catch(B){}F.focus();return F};CBA.Widgets.Utilities.writeLoadingImage=function(){document.write(CBA.Widgets.Constants.LOADING_HTML)};CBA.Widgets.Utilities.closePopUp=function(C){for(var A in CBA.Widgets.mediator.registry){var B=CBA.Widgets.mediator.registry[A];if(typeof (B.popupWindow)!="undefined"&&typeof (B.popupWindowName)!="undefined"&&B.popupWindowName==C&&!B.popupWindow.closed){B.popupWindow.close();B.popupWindow=undefined;B.popupWindowName=undefined}}};CBA.Widgets.Utilities.setupJsonp=function(C,B){if(C===null||B===null){return }var D="CBAJsonpScriptId"+B;var A=CBA.Widgets.Constants.WIDGET_ENDPOINT+CBA.Widgets.Constants.JSONP_URI+B+"&cartOwnerId="+C+"&url="+window.location.hostname;CBA.Widgets.Utilities.addScriptNodetoBody({"id":D,"URI":A})};CBA.Widgets.Utilities.addScriptNodetoBody=function(D){var F=D.id;var E=D.URI;if(typeof (F)!=="undefined"&&F!=null&&typeof (E)!=="undefined"&&E!=null){var B=CBA.jQuery("#"+F);if(B===null||typeof (B)==="undefined"||B.length===0){var C=document.createElement("script");C.id=F;C.type="text/javascript";C.src=E;var A=document.getElementsByTagName("body")[0];if(A!==null&&typeof (A)!=="undefined"){A.appendChild(C)}}}};CBA.Widgets.Utilities.setJsonpResponse=function(A){if(A!==null&&typeof (A)==="object"&&A.action!==null&&typeof (A.data)==="object"&&A.data!==null){CBA.Widgets.Utilities.JsonpMap[A.action](A.data)}};CBA.Widgets.Utilities.setupBridgeIframe=function(){var A="#"+CBA.Widgets.Constants.BRIDGE_IFRAME_NAME;var B=CBA.jQuery(A);if(typeof (B)==="undefined"||B.length==0){var D=CBA.Widgets.Constants.WIDGET_ENDPOINT+CBA.Widgets.Constants.BRIDGE_WIDGET_URI;var C=CBA.Widgets.Utilities.createIframeStringWithSrc(CBA.Widgets.Constants.BRIDGE_IFRAME_NAME,D,"1px","1px");CBA.jQuery(document.body).append(C);CBA.jQuery(A).css("display","none")}};CBA.Widgets.Utilities.setTarget=function(B,A){CBA.jQuery("#"+B).attr("target",A);window.v2popup.focus();window.v2popup.opener=window.self};CBA.Widgets.Utilities.setNewHash=function(A){var B=window.top.location.href;B=B.replace(/#.*$/,"#");if(A.length>0){B+=A}window.top.location.replace(B)};CBA.Widgets.Utilities.removeFromHash=function(B,A){B=decodeURIComponent(B);B=B.replace(A,"");B=encodeURIComponent(B);return B};CBA.Widgets.Utilities.pollTaskQueue=function(){while(!CBA.Widgets.taskQueue.isEmpty()){var A=CBA.Widgets.taskQueue.pop();if(typeof (A.execute)==="function"){A.execute()}}window.setTimeout(CBA.Widgets.Utilities.pollTaskQueue,CBA.Widgets.Constants.TIMER_INTERVAL)};CBA.Widgets.Utilities.pollEvents=function(){var B=window.top.location.hash;if(!B){return }B=B.replace(/#/,"");var A=CBA.Widgets.Utilities.parseMessage(B);if(typeof (A.stringToBeRemoved)!="undefined"){B=CBA.Widgets.Utilities.removeFromHash(B,A.stringToBeRemoved);CBA.Widgets.Utilities.setNewHash(B);CBA.Widgets.mediator.notifyListeners(A)}};CBA.Widgets.Utilities.handleMessage=function(B){if(typeof (B)=="undefined"||B.origin!=CBA.Widgets.Constants.WIDGET_ENDPOINT){return }var C=B.data;if(typeof (C)=="undefined"){return }var A=CBA.Widgets.Utilities.parseMessage(C);if(typeof (A.eventName)!="undefined"){CBA.Widgets.mediator.notifyListeners(A)}};CBA.Widgets.Utilities.parseMessage=function(E){var D=new Object();if(E.indexOf(CBA.Widgets.EventTypes.EXPRESS_CHK_ONAUTHORIZE,0)>=0){var B=E.indexOf(CBA.Widgets.EventTypes.EXPRESS_CHK_ONAUTHORIZE,0);var A=E.substring(B+CBA.Widgets.EventTypes.EXPRESS_CHK_ONAUTHORIZE.length);D.eventName=CBA.Widgets.EventTypes.EXPRESS_CHK_ONAUTHORIZE;D.eventValue=A;D.stringToBeRemoved=CBA.Widgets.EventTypes.EXPRESS_CHK_ONAUTHORIZE+A}else{if(E.indexOf(CBA.Widgets.EventTypes.REFRESH,0)>=0){D.eventName=CBA.Widgets.EventTypes.REFRESH;D.eventValue="";D.stringToBeRemoved=CBA.Widgets.EventTypes.REFRESH}else{if(E.indexOf(CBA.Widgets.EventTypes.WIDGET_REFRESH,0)>=0){var B=E.indexOf(CBA.Widgets.EventTypes.WIDGET_REFRESH,0);var C=E.substring(B+CBA.Widgets.EventTypes.WIDGET_REFRESH.length);D.eventName=CBA.Widgets.EventTypes.WIDGET_REFRESH;D.eventValue=C;D.stringToBeRemoved=CBA.Widgets.EventTypes.WIDGET_REFRESH+C}else{if(E.indexOf(CBA.Widgets.EventTypes.ON_ADDRESS_SELECT,0)>=0){var B=E.indexOf(CBA.Widgets.EventTypes.ON_ADDRESS_SELECT,0);var C=E.substring(B+CBA.Widgets.EventTypes.ON_ADDRESS_SELECT.length);D.eventName=CBA.Widgets.EventTypes.ON_ADDRESS_SELECT;D.eventValue=C;D.stringToBeRemoved=CBA.Widgets.EventTypes.ON_ADDRESS_SELECT+C}else{if(E.indexOf(CBA.Widgets.EventTypes.ON_PAYMENT_SELECT,0)>=0){var B=E.indexOf(CBA.Widgets.EventTypes.ON_PAYMENT_SELECT,0);var C=E.substring(B+CBA.Widgets.EventTypes.ON_PAYMENT_SELECT.length);D.eventName=CBA.Widgets.EventTypes.ON_PAYMENT_SELECT;D.eventValue=C;D.stringToBeRemoved=CBA.Widgets.EventTypes.ON_PAYMENT_SELECT+C}else{if(E.indexOf(CBA.Widgets.EventTypes.ON_CLOSE,0)>=0){var B=E.indexOf(CBA.Widgets.EventTypes.ON_CLOSE,0);var C=E.substring(B+CBA.Widgets.EventTypes.ON_CLOSE.length);D.eventName=CBA.Widgets.EventTypes.ON_CLOSE;D.eventValue=C;D.stringToBeRemoved=CBA.Widgets.EventTypes.ON_CLOSE+C}else{if(E.indexOf(CBA.Widgets.EventTypes.ON_PPH_WIDGET_CLOSE,0)>=0){D.eventName=CBA.Widgets.EventTypes.ON_PPH_WIDGET_CLOSE;D.eventValue="";D.stringToBeRemoved=CBA.Widgets.EventTypes.ON_PPH_WIDGET_CLOSE}else{if(E.indexOf(CBA.Widgets.EventTypes.PRIME_WIDGET_RESIZE,0)>=0){var B=E.indexOf(CBA.Widgets.EventTypes.PRIME_WIDGET_RESIZE,0);D.eventName=CBA.Widgets.EventTypes.PRIME_WIDGET_RESIZE;CBA.Widgets.PrimeWidget.parseResizeMessage(E,D);D.stringToBeRemoved=decodeURIComponent(E.substring(B))}else{if(E.indexOf(CBA.Widgets.EventTypes.ON_ERROR,0)>=0){var B=E.indexOf(CBA.Widgets.Constants.WIDGETID_PARAM_NAME);var C=E.substring(B+CBA.Widgets.Constants.WIDGETID_PARAM_NAME.length);D.eventName=CBA.Widgets.EventTypes.ON_ERROR;D.eventValue=C;D.stringToBeRemoved=E;D.errorCode=E.substring(0,B)}else{if(E.indexOf(CBA.Widgets.EventTypes.REDIRECT_URL,0)>=0){var B=E.indexOf(CBA.Widgets.EventTypes.REDIRECT_URL,0);var F=E.substring(B+CBA.Widgets.EventTypes.REDIRECT_URL.length);D.eventName=CBA.Widgets.EventTypes.REDIRECT_URL;D.eventValue=F;D.stringToBeRemoved=CBA.Widgets.EventTypes.REDIRECT_URL+F}}}}}}}}}}return D};CBA.Widgets.Utilities.eraseCookie=function(A){CBA.Widgets.Utilities.createCookie(A,"",-1)};CBA.Widgets.Utilities.createCookie=function(D,E,B){var A="";if(B){var C=new Date();C.setTime(C.getTime()+(B*60*60*1000));A="; expires="+C.toGMTString()}document.cookie=D+"="+E+A+"; path=/"};CBA.Widgets.Utilities.isCookiePresent=function(B){var A=CBA.Widgets.Utilities.readCookie(B);if(undefined!=A&&null!=A){return true}else{return false}};CBA.Widgets.Utilities.readCookie=function(F){if(document.cookie&&document.cookie!=""){var C=document.cookie.split(";");for(var B=0;B<C.length;B++){var E=C[B];var D=E.split("=");var A=D[0].replace(/ /,"");if(A.indexOf(F)==0){return D[1]}}}return null};CBA.Widgets.Utilities.createWidgetContainer=function(B,G,D,A,E){var C=CBA.Widgets.Utilities.getDefaultWidgetContainerStyle(D,A,"block");var H='id="'+G+'"';var F="<div "+C+" "+H+">";if(E!=undefined){F+=E}F+="</div>";CBA.jQuery("#"+B).html(F);return CBA.jQuery("#"+G)};CBA.Widgets.Utilities.isEmptyOrUndefined=function(A){return(typeof (A)==="undefined"||A===null||A.length===0)};CBA.Widgets.Utilities.getDefaultWidgetContainerStyle=function(D,A,B){B=CBA.Widgets.Utilities.isEmptyOrUndefined(B)?"block":B;var C='style="padding: 0; margin: 0; overflow: hidden; display: '+B+"; ";C+="width: "+D+"px; height: "+A+"px; ";C+='background: url(https://images-na.ssl-images-amazon.com/images/G/01/ui/loadIndicators/loading-small_labeled.gif) no-repeat center;" ';return C};CBA.Widgets.Utilities.createWidgetForm=function(M,L,D,N,K,I){var H=CBA.jQuery("#"+M);var F=H.closest("form");if(typeof (F)!=="undefined"&&F.length>0){L+="WidgetForm";var B=CBA.Widgets.Utilities.getDefaultWidgetContainerStyle(D,N,"none");var C='id="'+L+'"';var E="<span "+B+" "+C+">"+K+"</span>";if(F.nextAll().length>0){CBA.jQuery(E).insertBefore(F.next())}else{var J=new CBA.Widgets.Task.WidgetRenderFormTask(I,E);CBA.Widgets.taskQueue.push(J)}}else{var G=CBA.jQuery("#"+L);if(G.length===0){var B=CBA.Widgets.Utilities.getDefaultWidgetContainerStyle(D,N);var C='id="'+L+'"';var A="<span "+B+" "+C+"></span>";H.html(A)}G=CBA.jQuery("#"+L);G.append(K)}};CBA.Widgets.Utilities.createIFrameString=function(C,B,A){return CBA.Widgets.Utilities.createIframeStringWithSrc(C,"",B,A)};CBA.Widgets.Utilities.createIframeStringWithSrc=function(F,E,C,A){var B='style="margin: 0; padding: 0; border-width: 0; overflow: hidden;"';var D='<iframe id="'+F+'" name="'+F+'" ';D+='src="'+E+'" ';D+=B;D+='frameborder="no" ';D+='scrolling="no" ';D+='allowtransparency="true" ';D+="width="+C+" height="+A+"></iframe>";return D};CBA.Widgets.Utilities.createFormString=function(F,D,E,A){var C='style="display: none; margin: 0; padding: 0; border-width: 0; overflow: hidden;"';var B="<form "+C+' id="'+F+'" ';B+='action="'+D+'" ';B+='accept-charset="UTF-8" ';B+='method="POST" target="'+E+'">';CBA.jQuery.each(A,function(G,H){B+='<input type="hidden" name="'+G+'" value="'+H+'"/>'});B+="</form>";return B};CBA.Widgets.Utilities.setFormInputValueByName=function(E,C,A){var B;try{B=CBA.jQuery("#"+E).find("input").filter("[@name="+C+"]")}catch(D){B=CBA.jQuery("#"+E).find("input").filter("[name="+C+"]")}if(B.length==0){CBA.jQuery("#"+E).append('<input type="hidden" name="'+C+'" value="'+A+'">')}else{B.val(A)}};CBA.Widgets.Utilities.verifySize=function(C,D,B,A){if(C==undefined){return D}C=parseFloat(C);if(C==null||typeof (C)=="undefined"||isNaN(C)){return D}if(C<B){return B}if(C>A){return A}return C};CBA.Widgets.Utilities.baseDomainsMatch=function(E,C){if(typeof (E)!=="string"||typeof (C)!=="string"){return false}var A=true;var D=E.split(".");var B=C.split(".");if(D.length>=2&&B.length>=2){A=(D[D.length-1]==B[B.length-1])&&(D[D.length-2]==B[B.length-2])}return A};CBA.Widgets.Utilities.isValidDocInclusion=function(){var B=true;try{var A=window.top.document.domain;var D=document.domain;B=CBA.Widgets.Utilities.baseDomainsMatch(A,D)}catch(C){B=false}return B};CBA.Widgets.V1=function(){};CBA.Widgets.V1.Constants={};CBA.Widgets.V1.Constants.allowV2=true;CBA.Widgets.V1.Constants.SERVER_SIDE_MARKER="cbaOneClickForm";CBA.Widgets.V1.Constants.APAY_CHECKOUT_URL="amazon.com/checkout";CBA.Widgets.V1.Constants.SubmitStates={"TRUE":0,"FALSE":1,"TRIGGERED":2};CBA.Widgets.V1.Constants.canSubmitForm=0;CBA.Widgets.V1.Constants.BUTTON_APP_SOURCE=/gp\/cba\/button/;CBA.Widgets.V1.Constants.MEDIA_SERVER_SOURCE=/cba\/images\/buttons/;CBA.Widgets.V1.Constants.DOMImageType={"STANDARD_IMAGE":0,"FORM_SUBMIT":1},CBA.Widgets.V1.Constants.BUTTON_APP_URL=CBA.Widgets.Constants.WIDGET_ENDPOINT+"/gp/cba/button";CBA.Widgets.V1.Constants.CART_IMAGE_NAME=/btn_Chkout/;CBA.Widgets.V1.Constants.DETAIL_PAGE_IMAGE_NAME=/button-buyNowWithAmazon/;CBA.Widgets.V1.Constants.BUTTON_BACKGROUND_LIGHT="light";CBA.Widgets.V1.Constants.BUTTON_BACKGROUND_DARK="dark";CBA.Widgets.V1.Constants.BUTTON_TYPE_CART="cart";CBA.Widgets.V1.Constants.BUTTON_TYPE_EXPRESS="express";CBA.Widgets.V1.Constants.BUTTON_PROP_SIZE="size";CBA.Widgets.V1.Constants.BUTTON_PROP_COLOR="color";CBA.Widgets.V1.Constants.BUTTON_PROP_BACKGROUND="background";CBA.Widgets.V1.Constants.BUTTON_PROP_TYPE="type";CBA.Widgets.V1.Constants.BUTTON_PROP_ENABLED="enabled";CBA.Widgets.V1.Constants.BUTTON_CART_OWNER_ID="cartOwnerId";CBA.Widgets.V1.Constants.BUTTON_REGIONS={"CBA_REGION":"cbaRegion"};CBA.Widgets.V1.Constants.RESTRICTED_BUTTON_APP_SOURCE=/gp\/cba\/button[\?|\/]/;CBA.Widgets.V1.Constants.RESTRICTED_MEDIA_SERVER_SOURCE=/buttons[\?|\/]|buttons_02_2010[\?|\/]|buttons2010/;CBA.Widgets.V1.Constants.ALLOWED_MERCHANT_IDS_FOR_OLD_MEDIA_SRC_URL="AKJJGJ0JKT8F1,A51V5J3RXHHIP,APH6V7HBA24CM";CBA.Widgets.V1.Constants.IS_CBA_BUTTON_CLICK="false";CBA.Widgets.V1.Constants.V2_POP_UP_HANDLE=null;CBA.Widgets.V1.Constants.V2_OFP_URL="/gp/cba/v2/ofp/";CBA.Widgets.V1.Constants.CART_ORIGIN=CBA.Widgets.CartOrigins.CartPage;CBA.Widgets.V1.Constants.BUTTON_CLICK_COORDS={"LEFT":1,"TOP":1};CBA.Widgets.V1.Utilities=function(){};CBA.Widgets.V1.Utilities.isCBARecommendedImage=function(A){return CBA.Widgets.V1.Constants.BUTTON_APP_SOURCE.test(A)};CBA.Widgets.V1.Utilities.isMediaServerImage=function(A){return CBA.Widgets.V1.Constants.MEDIA_SERVER_SOURCE.test(A)};CBA.Widgets.V1.Utilities.isCBAImage=function(A){return CBA.Widgets.V1.Utilities.isCBARecommendedImage(A)||CBA.Widgets.V1.Utilities.isMediaServerImage(A)};CBA.Widgets.V1.Utilities.isCartPageImage=function(A){return CBA.Widgets.V1.Constants.CART_IMAGE_NAME.test(A)};CBA.Widgets.V1.Utilities.isDetailPageImage=function(A){return CBA.Widgets.V1.Constants.DETAIL_PAGE_IMAGE_NAME.test(A)};CBA.Widgets.V1.Utilities.getButtonType=function(A){if(CBA.Widgets.V1.Utilities.isCartPageImage(A)){return CBA.Widgets.V1.Constants.BUTTON_TYPE_CART}else{return CBA.Widgets.V1.Constants.BUTTON_TYPE_EXPRESS}};CBA.Widgets.V1.Utilities.setCBAButtonClick=function(A){CBA.Widgets.V1.Constants.IS_CBA_BUTTON_CLICK=A};CBA.Widgets.V1.Utilities.isCBAButtonClick=function(){return CBA.Widgets.V1.Constants.IS_CBA_BUTTON_CLICK};CBA.Widgets.V1.Utilities.extractButtonStyleParamsFromString=function(A){var D=new Object();var C=A.lastIndexOf("?",A.length);if(C!=-1){A=A.substring(C+1,A.length)}var F=A.split("&");for(var E=0;E<F.length;E++){var B=F[E].split("=");D[B[0]]=B[1]}return D};CBA.Widgets.V1.Utilities.extractButtonStyleParamsFromMediaServerURL=function(A){var I=A.lastIndexOf("/",A.length);var E=A.lastIndexOf(".",A.length);A=A.substring(I+1,E);var H=new Array();var G=A.split("-");var D=G.pop();var C=G.pop();if(C=="x"){H[CBA.Widgets.V1.Constants.BUTTON_PROP_SIZE]=C+"-"+D}else{H[CBA.Widgets.V1.Constants.BUTTON_PROP_SIZE]=D;G.push(C)}H[CBA.Widgets.V1.Constants.BUTTON_PROP_COLOR]=G.pop();H[CBA.Widgets.V1.Constants.BUTTON_PROP_TYPE]=CBA.Widgets.V1.Utilities.getButtonType(A);var B=G.pop();if(B==CBA.Widgets.V1.Constants.BUTTON_BACKGROUND_LIGHT){H[CBA.Widgets.V1.Constants.BUTTON_PROP_BACKGROUND]=B}else{if(/Txt/i.test(B)){H[CBA.Widgets.V1.Constants.BUTTON_PROP_BACKGROUND]=CBA.Widgets.V1.Constants.BUTTON_BACKGROUND_DARK;var F=B.indexOf("Txt");B=B.substr(0,F)}if(G.length!=0){H[CBA.Widgets.V1.Constants.BUTTON_PROP_ENABLED]="false"}}return H};CBA.Widgets.V1.cbaImages=new Array(0);CBA.Widgets.CBAImage=function(A,E,B,C){var G;var B;var F;var H;var I;this.domImage=A;this.domImageType=E;this.imageSrc=CBA.jQuery(this.domImage).attr("src");if(B==undefined){this.setButtonImageProperties()}else{this.imageProperties=B}if(C!==undefined&&C==true){CBA.jQuery(this.domImage).bind("click",this,this.onClickHandler);if(typeof (this.imageProperties)!=="undefined"){var J=this.imageProperties["cartOwnerId"]}var D=this.imageProperties[CBA.Widgets.V1.Constants.BUTTON_PROP_ENABLED];if(typeof (D)!="undefined"){this.isEnabled=D}else{this.isEnabled=true}}};CBA.Widgets.CBAImage.prototype.getImageSource=function(){return this.imageSrc};CBA.Widgets.CBAImage.prototype.getAmazonPaymentsImageSource=function(){var A=new Array();A.push(this.getBackground()===null?"":"background="+this.getBackground());A.push(this.getColor()===null?"":CBA.Widgets.V1.Constants.BUTTON_PROP_COLOR+"="+this.getColor());A.push(this.getSize()===null?"":CBA.Widgets.V1.Constants.BUTTON_PROP_SIZE+"="+this.getSize());A.push(this.getType()===null?"":CBA.Widgets.V1.Constants.BUTTON_PROP_TYPE+"="+this.getType());A.push(this.getCartOwnerId()===null?"":CBA.Widgets.V1.Constants.BUTTON_CART_OWNER_ID+"="+this.getCartOwnerId());var B=CBA.Widgets.V1.Constants.BUTTON_APP_URL+"?";for(var C=0;C<A.length;C++){if(A[C]!=""){B=B+A[C]+"&"}}return B};CBA.Widgets.CBAImage.prototype.getBackground=function(){if(typeof (this.imageProperties)!="undefined"&&typeof (this.imageProperties[CBA.Widgets.V1.Constants.BUTTON_PROP_BACKGROUND])!="undefined"){return this.imageProperties[CBA.Widgets.V1.Constants.BUTTON_PROP_BACKGROUND]}else{return null}};CBA.Widgets.CBAImage.prototype.getColor=function(){if(typeof (this.imageProperties)!="undefined"&&typeof (this.imageProperties[CBA.Widgets.V1.Constants.BUTTON_PROP_COLOR])!="undefined"){return this.imageProperties[CBA.Widgets.V1.Constants.BUTTON_PROP_COLOR]}else{return null}};CBA.Widgets.CBAImage.prototype.getSize=function(){if(typeof (this.imageProperties)!="undefined"&&typeof (this.imageProperties[CBA.Widgets.V1.Constants.BUTTON_PROP_SIZE])!="undefined"){return this.imageProperties[CBA.Widgets.V1.Constants.BUTTON_PROP_SIZE]}else{return null}};CBA.Widgets.CBAImage.prototype.getType=function(){if(typeof (this.imageProperties)!="undefined"&&typeof (this.imageProperties[CBA.Widgets.V1.Constants.BUTTON_PROP_TYPE])!="undefined"){return this.imageProperties[CBA.Widgets.V1.Constants.BUTTON_PROP_TYPE]}else{return null}};CBA.Widgets.CBAImage.prototype.getCartOwnerId=function(){if(typeof (this.imageProperties)!="undefined"&&typeof (this.imageProperties[CBA.Widgets.V1.Constants.BUTTON_CART_OWNER_ID])!="undefined"){return this.imageProperties[CBA.Widgets.V1.Constants.BUTTON_CART_OWNER_ID]}else{return null}};CBA.Widgets.CBAImage.prototype.isWhitelistByMerchantId=function(){var D=this.imageSrc;var A="cartOwnerId=";var C="undefined";var B=D.indexOf(A);if(B>=0){C=D.substr(B+12)}if(C.indexOf("&")>0){C=C.substr(0,C.indexOf("&"))}return((CBA.Widgets.V1.Constants.ALLOWED_MERCHANT_IDS_FOR_OLD_MEDIA_SRC_URL.indexOf(C)>=0))};CBA.Widgets.CBAImage.prototype.isWhitelistByButtonSource=function(){var B=this.imageSrc;var A=CBA.Widgets.Constants.WIDGET_ENDPOINT.substr(CBA.Widgets.Constants.WIDGET_ENDPOINT.indexOf("//")+2);return(B.indexOf(A)>=0&&CBA.Widgets.V1.Constants.RESTRICTED_BUTTON_APP_SOURCE.test(B))||(CBA.Widgets.V1.Constants.MEDIA_SERVER_SOURCE.test(B)&&!CBA.Widgets.V1.Constants.RESTRICTED_MEDIA_SERVER_SOURCE.test(B)&&(CBA.Widgets.V1.Utilities.isCartPageImage(B)||CBA.Widgets.V1.Utilities.isDetailPageImage(B)))};CBA.Widgets.CBAImage.prototype.isButtonImagePartitioned=function(){var A=this.imageSrc;if(A!==null&&A!=="undefined"){return this.isWhitelistByButtonSource()?true:this.isWhitelistByMerchantId()}return false};CBA.Widgets.CBAImage.prototype.onClickHandler=function(A){if(CBA.Widgets.V1.allowV2()){CBA.Widgets.V1.openV2PopUp()}if(A.data.imageProperties[CBA.Widgets.V1.Constants.BUTTON_PROP_TYPE]===CBA.Widgets.V1.Constants.BUTTON_TYPE_EXPRESS){CBA.Widgets.V1.Constants.CART_ORIGIN=CBA.Widgets.CartOrigins.DetailPage}else{CBA.Widgets.V1.Constants.CART_ORIGIN=CBA.Widgets.CartOrigins.CartPage}CBA.Widgets.V1.Constants.BUTTON_CLICK_COORDS.LEFT=CBA.jQuery(A.data).offset().left;CBA.Widgets.V1.Constants.BUTTON_CLICK_COORDS.TOP=CBA.jQuery(A.data).offset().top-3;var B=CBA.jQuery(document).height();if((B-CBA.Widgets.V1.Constants.BUTTON_TOP)<215){CBA.Widgets.V1.Constants.BUTTON_CLICK_COORDS.TOP=B-195}CBA.Widgets.V1.Utilities.setCBAButtonClick(true)};CBA.Widgets.CBAImage.prototype.setButtonImageProperties=function(){if(CBA.Widgets.V1.Utilities.isCBARecommendedImage(this.imageSrc)){this.imageProperties=CBA.Widgets.V1.Utilities.extractButtonStyleParamsFromString(this.imageSrc);return }else{if(CBA.Widgets.V1.Utilities.isMediaServerImage(this.imageSrc)){this.imageProperties=CBA.Widgets.V1.Utilities.extractButtonStyleParamsFromMediaServerURL(this.imageSrc);return }}};CBA.Widgets.V1.Form=function(){};CBA.Widgets.V1.Form.isCBAForm=function(A){var B=CBA.jQuery(A).attr("action");var C=CBA.jQuery(A).attr("id");return(typeof (B)!="undefined"&&typeof (C)!="undefined"&&(B.match(CBA.Widgets.V1.Constants.APAY_CHECKOUT_URL)!=null||C.match(CBA.Widgets.V1.Constants.SERVER_SIDE_MARKER)!=null))};CBA.Widgets.V1.Form.getAction=function(A){return CBA.jQuery(A).attr("action")};CBA.Widgets.V1.Form.setAction=function(A,B){CBA.jQuery(A).attr("action",B)};CBA.Widgets.V1.Form.getTarget=function(A){return CBA.jQuery(A).attr("target")};CBA.Widgets.V1.Form.setTarget=function(A,B){CBA.jQuery(A).attr("target",B)};CBA.Widgets.V1.Form.getCartOwnerId=function(A){var B=CBA.Widgets.V1.Form.getAction(A);return CBA.Widgets.V1.Form.getCartOwnerIdFromFormAction(B)};CBA.Widgets.V1.Form.isV2Form=function(A){var B=CBA.Widgets.V1.Form.getAction(A);return B.match(CBA.Widgets.Constants.STANDARD_CHECKOUT_URI)!=null};CBA.Widgets.V1.Form.setV2Action=function(B){if(CBA.Widgets.V1.allowV2()){if(!CBA.Widgets.V1.Form.isV2Form(B)){var C=CBA.Widgets.V1.Form.getCartOwnerId(B);if(C!==null||typeof (C)!=="undefined"){var A=CBA.Widgets.Constants.WIDGET_ENDPOINT+CBA.Widgets.Constants.STANDARD_CHECKOUT_URI+"/"+C;CBA.Widgets.V1.Form.setAction(B,A)}}}};CBA.Widgets.V1.Form.getCartOwnerIdFromFormAction=function(C){var B="checkout";var E=C.lastIndexOf("?",C.length);if(E!=-1){C=C.substring(0,E)}var G="";var F="";var A=C.lastIndexOf("/",C.length);if(A+1!=C.length){G=C.substring(A+1,C.length)}else{var D=C.lastIndexOf("/",A-1);G=C.substring(D+1,A)}if(G.match(B)){F=""}else{F=G}return F};CBA.Widgets.V1.Form.setFormTarget=function(A){if(CBA.Widgets.V1.allowV2()){CBA.jQuery(A).attr("target",CBA.Widgets.Constants.POPUP_WIN_NAME)}};CBA.Widgets.V1.Form.addFormInputs=function(B,A){CBA.jQuery.each(A,function(C,D){CBA.Widgets.V1.Form.setInputValue(B,C,D)})};CBA.Widgets.V1.Form.getInputValue=function(A,B){return CBA.jQuery(A).find("input[name='"+B+"']").val()};CBA.Widgets.V1.Form.setInputValue=function(C,B,A){CBA.jQuery(C).append("<input type='hidden' name='"+B+"' value='"+A+"'/>")};CBA.Widgets.V1.checkIfAmazon=function(A){if(CBA.Widgets.V1.Form.isCBAForm(A)){var B=CBA.Widgets.V1.Form.getCartOwnerId(A);if(B!==null||typeof (B)!=="undefined"){CBA.Widgets.Utilities.setupJsonp(B,"upgrade")}CBA.Widgets.V1.Form.setV2Action(A);CBA.Widgets.V1.Form.setTarget(A,CBA.Widgets.Constants.POPUP_WIN_NAME);CBA.jQuery(A).submit(function(){return CBA.Widgets.V1.formSubmitHandler(this)})}};CBA.Widgets.V1.addCBAImage=function(B,C){var A=new CBA.Widgets.CBAImage(B,C,null,true);CBA.Widgets.V1.cbaImages.push(A)};CBA.Widgets.V1.registerCBAImages=function(){CBA.jQuery("img").each(function(){var A=CBA.jQuery(this).attr("src");if(CBA.Widgets.V1.Utilities.isCBAImage(A)){CBA.Widgets.V1.addCBAImage(this,CBA.Widgets.V1.Constants.DOMImageType.STANDARD_IMAGE)}});CBA.jQuery("input:image").each(function(){var A=CBA.jQuery(this).attr("src");if(CBA.Widgets.V1.Utilities.isCBAImage(A)){CBA.Widgets.V1.addCBAImage(this,CBA.Widgets.V1.Constants.DOMImageType.FORM_SUBMIT)}})};CBA.Widgets.V1.lookForMerchantV1Forms=function(){var A=CBA.jQuery("form").each(function(){CBA.Widgets.V1.checkIfAmazon(this)})};CBA.Widgets.V1.formSubmitHandler=function(A){return CBA.Widgets.V1.showV2(A,CBA.Widgets.V1.Constants.BUTTON_CLICK_COORDS.LEFT,CBA.Widgets.V1.Constants.BUTTON_CLICK_COORDS.TOP)};window.showCBAWidget=function(A,C,B){CBA.Widgets.V1.showV2(A,C,B)};CBA.Widgets.V1.openV2PopUp=function(){CBA.Widgets.V1.Constants.V2_POP_UP_HANDLE=CBA.Widgets.Utilities.openPopUp(CBA.Widgets.Constants.POPUP_WIN_NAME)};CBA.Widgets.V1.showV2=function(B,D,C){if(!CBA.Widgets.Browser.isSafari2()){var A={};var E=CBA.Widgets.V1.Form.getCartOwnerId(B);A["cartOwnerId"]=E;A["formX"]=D;A["formY"]=C;A["referringURL"]=window.top.location;A["cba_v2"]="true";A["cartOrigin"]=CBA.Widgets.V1.Constants.CART_ORIGIN;CBA.Widgets.V1.Form.addFormInputs(B,A);CBA.Widgets.V1.Form.setV2Action(B);CBA.Widgets.V1.Form.setFormTarget(B);CBA.Widgets.V1.openV2PopUp()}return true};CBA.Widgets.V1.processMerchantPage=function(){CBA.Widgets.V1.lookForMerchantV1Forms();CBA.Widgets.V1.registerCBAImages();CBA.Widgets.Utilities.setupJsonp(null,"upgrade")};CBA.Widgets.V1.setupV2UpgradeScript=function(A){return };CBA.Widgets.V1.allowV2=function(){return CBA.Widgets.V1.Constants.allowV2};CBA.Widgets.ButtonSettings=function(A){if(typeof (A)!="undefined"){this.size=A.size;this.color=A.color;this.background=A.background}};CBA.Widgets.Widget=function(A){this.collector=new CBA.Metrics.Collector();var B=CBA.Widgets.Constants.WIDGETID_PREFIX+CBA.Widgets.mediator.generateUniqWidgetID();this.getID=function(){return B};CBA.Widgets.V1.Constants.allowV2=false;CBA.Widgets.mediator.register(this);CBA.jQuery(this).bind(CBA.Widgets.EventTypes.DOCUMENT_READY,this,this.documentReadyEventHandler);this.getMerchantId=function(){return(A.merchantId!=null&&typeof (A.merchantId)!=="undefined")?A.merchantId:""}};CBA.Widgets.Widget.prototype.renderImpl=function(A){if(A||CBA.Widgets.Constants.DOCUMENT_LOAD_COMPLETED||CBA.jQuery("#"+this.locationID).next().length>0){this.renderElements();this.bindClickHandler(this)}};CBA.Widgets.Widget.prototype.removeEventListener=CBA.Widgets.Widget.prototype.detachEvent=function(){};CBA.Widgets.Widget.prototype.render=function(A){var B=CBA.Widgets.Utilities.isValidDocInclusion()&&(this.getMerchantId()!="");if(B){this.locationID=A;this.renderRequested=true;this.renderImpl(false)}return this};CBA.Widgets.Widget.prototype.renderElements=function(){return""};CBA.Widgets.Widget.prototype.bindClickHandler=function(){return""};CBA.Widgets.Widget.prototype.documentReadyEventHandler=function(A,B){if(this.renderRequested&&!CBA.jQuery("#"+this.getID()).length){B.renderImpl(true)}};CBA.Widgets.Widget.prototype.getLocation=function(){return this.locationID};CBA.Widgets.Widget.prototype.getWidgetType=function(){return this.type};CBA.Widgets.Widget.prototype.encodeShippingRestrictions=function(){var A=JSON.stringify(this.shippingRestrictions);var B=A.replace(/\"/g,"&quot;");return B};CBA.Widgets.CheckoutWidget=function(A){CBA.Widgets.Widget.call(this,A);if(typeof (A.merchantId)!="undefined"&&A.merchantId!=null){CBA.Widgets.Constants.CartOwnerId=A.merchantId}this.buttonSettings=new CBA.Widgets.ButtonSettings(A.buttonSettings)};CBA.Widgets.CheckoutWidget.prototype=CBA.Widgets.createSubclass(CBA.Widgets.Widget.prototype);CBA.Widgets.CheckoutWidget.prototype.constructor=CBA.Widgets.CheckoutWidget;CBA.Widgets.CheckoutWidget.prototype.getClickRatios=function(A){var D=CBA.jQuery(this).offset().top;var C=CBA.jQuery(this).offset().left;var I=CBA.jQuery(this).height();var F=CBA.jQuery(this).width();var G=A.data.clickYPos-D;var H=A.data.clickXPos-C;var E=G/I;var B=H/F;return[B,E]};CBA.Widgets.CheckoutWidget.prototype.isCashbackTermsLinkClicked=function(C){if(CBA.Widgets.Constants.IS_CASHBACK_BUTTON_SHOWN){var D=CBA.Widgets.CheckoutWidget.prototype.getClickRatios.call(this,C);var A=D[1];var B=D[0];return B>0.7&&B<=1&&A>=0.1&&A<=0.4}return false};CBA.Widgets.CheckoutWidget.prototype.onErrorCallbackHandler=function(B){var C=B.data;var A=C.eventValue;if(this.getID()==A){this.onErrorCallback(C.errorCode)}};CBA.Widgets.CheckoutWidget.prototype.onCashbackTermsAndConditionsClicked=function(A){window.open("TBD","TBD","TBD")};CBA.Widgets.CheckoutWidget.prototype.getPopupWindowName=function(){return CBA.Widgets.Constants.POPUP_WIN_NAME+this.getMerchantId()};CBA.Widgets.CheckoutWidget.prototype.documentReadyEventHandler=function(A,B){CBA.Widgets.Widget.prototype.documentReadyEventHandler.call(this,A,B)};CBA.Widgets.CheckoutWidget.prototype.bindClickHandler=function(A){var B=this.getCBAPreExistingButtons();if(B!=undefined&&B.length>0){for(i=0;i<B.length;i++){CBA.jQuery(B[i]).bind("click",A,A.onClickHandler)}}};CBA.Widgets.CheckoutWidget.prototype.onClickHandler=function(A){A.data.setupFormTargetArea(A);if(typeof (A.data.onOpen)==="undefined"||!A.data.onOpen){A.data.submit()}else{A.data.onOpen(A.data)}};CBA.Widgets.CheckoutWidget.prototype.setupFormTargetArea=function(A){var B=CBA.Widgets.Constants.POPUP_WIN_NAME+A.data.getMerchantId();if(CBA.Widgets.Constants.CHECKOUT_WORKFLOW=="v1"){CBA.Widgets.Utilities.writeLoadingImage()}else{A.data.popupWindow=CBA.Widgets.Utilities.openPopUp(B);A.data.popupWindowName=B}};CBA.Widgets.CheckoutWidget.prototype.renderElements=function(){var D=this.getCBAPreExistingButtons();if(D!=undefined&&D.length>0){this.collector.addCounter("image-present-in-div");this.collector.publish();return }this.collector.addCounter("image-added-by-js");this.collector.publish();var E=this.buttonSettings;var B="?cartOwnerId="+this.getMerchantId();if(E!=undefined){B+=(E.size!=undefined?("&size="+E.size):"")+(E.color!=undefined?("&color="+E.color):"")+(E.background!=undefined?("&background="+E.background):"")}var A=this.buttonType;if(A!=undefined){B+="&type="+A}var C='<img style="cursor: pointer;" src="'+CBA.Widgets.Constants.BUTTON_ENDPOINT+CBA.Widgets.Constants.BUTTON_URI+B+'" id="'+this.getID()+'"/>';CBA.jQuery("#"+this.locationID).append(C)};CBA.Widgets.CheckoutWidget.prototype.getCBAPreExistingButtons=function(){var C=this.getMerchantId();var A=CBA.Widgets.V1.Constants.BUTTON_CART_OWNER_ID+"="+C;var B=new Array();CBA.jQuery("#"+this.locationID+" img").each(function(){var E=CBA.jQuery(this).attr("src");if(E.indexOf(CBA.Widgets.Constants.BUTTON_ENDPOINT+CBA.Widgets.Constants.BUTTON_URI)==0){if(E.indexOf(A)==-1){var D=CBA.Widgets.V1.Utilities.extractButtonStyleParamsFromString(E);D[CBA.Widgets.V1.Constants.BUTTON_CART_OWNER_ID]=C;var F=new CBA.Widgets.CBAImage(this,CBA.Widgets.V1.Constants.DOMImageType.STANDARD_IMAGE,D,false);this.src=F.getAmazonPaymentsImageSource()}B.push(this)}});return B};CBA.Widgets.StandardCheckoutWidget=function(A){CBA.Widgets.CheckoutWidget.call(this,A);this.onOpen=A.onOpen;if(A.orderInput!=null){this.orderInput=A.orderInput.value;this.format=(typeof (A.orderInput.format)!="undefined"&&A.orderInput.format.toLowerCase()==CBA.Widgets.OrderInputFormats.HTML.toLowerCase())?CBA.Widgets.OrderInputFormats.HTML:CBA.Widgets.OrderInputFormats.XML}this.type=CBA.Widgets.WidgetTypes.StandardCheckoutWidget;this.buttonType=CBA.Widgets.ButtonTypes.STANDARD_CHECKOUT;this.cartOrigin=(typeof (A.cartOrigin)!="undefined"&&A.cartOrigin.toLowerCase()==CBA.Widgets.CartOrigins.DetailPage.toLowerCase())?CBA.Widgets.CartOrigins.DetailPage:CBA.Widgets.CartOrigins.CartPage;CBA.jQuery(this).bind(CBA.Widgets.EventTypes.REDIRECT_URL,this,this.redirectUrlEventHandler)};CBA.Widgets.StandardCheckoutWidget.prototype=CBA.Widgets.createSubclass(CBA.Widgets.CheckoutWidget.prototype);CBA.Widgets.StandardCheckoutWidget.prototype.constructor=CBA.Widgets.StandardCheckoutWidget;CBA.Widgets.StandardCheckoutWidget.prototype.redirectUrlEventHandler=function(C){var E=C.data.eventValue;var B=";returnUrl=";var A=E.indexOf(B,0);var D=E.substring(A+B.length);window.top.location.href=D;window.top.focus()};CBA.Widgets.StandardCheckoutWidget.prototype.onClickHandler=function(C){C.data.isMobile=false;C.data.showCashbackTermsAndConditions=false;if(CBA.Widgets.Mobile.isMobile()){C.data.isMobile=true}else{if(CBA.Widgets.Constants.IS_CASHBACK_BUTTON_SHOWN){C.data.clickXPos=C.pageX;C.data.clickYPos=C.pageY;if(typeof (C.data.clickYPos)!="undefined"&&typeof (C.data.clickXPos)!="undefined"){var E=CBA.Widgets.CheckoutWidget.prototype.getClickRatios.call(this,C);var A=E[1];var B=E[0];if(CBA.Widgets.CheckoutWidget.prototype.isCashbackTermsLinkClicked.call(this,C)){CBA.Widgets.CheckoutWidget.prototype.onCashbackTermsAndConditionsClicked.call(this,C);return }}var D=CBA.jQuery("#"+C.data.getID()).offset();if(D&&typeof (D)!=="undefined"){C.data.buttonLeft=D.left;C.data.buttonTop=D.top}}}CBA.Widgets.CheckoutWidget.prototype.onClickHandler.call(this,C)};CBA.Widgets.StandardCheckoutWidget.prototype.setupFormTargetArea=function(A){if(!A.data.isMobile){CBA.Widgets.CheckoutWidget.prototype.setupFormTargetArea.call(this,A)}};CBA.Widgets.StandardCheckoutWidget.prototype.updateOrderInput=function(A){this.format=A.format;this.orderInput=A.value};CBA.Widgets.StandardCheckoutWidget.prototype.submit=function(){var D=this.getID()+"Form";var G={};var H=(typeof (this.isMobile)!="undefined"&&this.isMobile);var F=this.getPopupWindowName();var E=null;var E=CBA.Widgets.Constants.WIDGET_ENDPOINT+CBA.Widgets.Constants.STANDARD_CHECKOUT_URI+"/"+this.getMerchantId();var I=E;if(this.format.toLowerCase()==CBA.Widgets.OrderInputFormats.XML.toLowerCase()){if(this.orderInput!=undefined){G["order-input"]=this.orderInput}}else{if(this.format.toLowerCase()==CBA.Widgets.OrderInputFormats.HTML.toLowerCase()){if(this.orderInput!=undefined){var A=this.orderInput;CBA.jQuery("#"+A).find(":input").each(function(){var K=CBA.jQuery(this).attr("name");var J=CBA.jQuery(this).attr("value");G[K]=J})}}}G["cartOrigin"]=this.cartOrigin;var C=F;if(H||(CBA.Widgets.Constants.CHECKOUT_WORKFLOW=="v1")){C="_self"}var B=CBA.Widgets.Utilities.createFormString(D,I,C,G);CBA.jQuery("#"+D).remove();CBA.jQuery(document.body).append(B);CBA.jQuery("#"+D).submit()};CBA.Widgets.ExpressCheckoutWidget=function(A){CBA.Widgets.CheckoutWidget.call(this,A);this.onOpen=A.onOpen;this.onAuthorize=A.onAuthorize;this.shippingRestrictions=A.shippingRestrictions;this.onErrorCallback=A.onErrorCallback;this.type=CBA.Widgets.WidgetTypes.ExpressCheckoutWidget;this.buttonType=CBA.Widgets.ButtonTypes.EXPRESS_CHECKOUT;this.purchaseContractId=A.purchaseContractId;this.getPurchaseContractId=function(){return this.purchaseContractId};CBA.jQuery(this).bind(CBA.Widgets.EventTypes.ON_ERROR,this,CBA.Widgets.CheckoutWidget.prototype.onErrorCallbackHandler)};CBA.Widgets.ExpressCheckoutWidget.prototype=CBA.Widgets.createSubclass(CBA.Widgets.CheckoutWidget.prototype);CBA.Widgets.ExpressCheckoutWidget.prototype.constructor=CBA.Widgets.ExpressCheckoutWidget;CBA.Widgets.ExpressCheckoutWidget.prototype.updateShippingRestrictions=function(A){this.shippingRestrictions=A};CBA.Widgets.ExpressCheckoutWidget.prototype.onAuthorizeEventHandler=function(A){var B=A.data;this.purchaseContractId=B.eventValue;CBA.Widgets.Utilities.createCookie(CBA.Widgets.Constants.PURCHASE_CONTRACT_ID_COOKIE_NAME,this.purchaseContractId,CBA.Widgets.Constants.PURCHASE_CONTRACT_ID_COOKIE_LIFETIME);if(this.onAuthorize!=undefined){this.onAuthorize(B)}CBA.jQuery(this).unbind(CBA.Widgets.EventTypes.EXPRESS_CHK_ONAUTHORIZE,this.onAuthorizeEventHandler)};CBA.Widgets.ExpressCheckoutWidget.prototype.onClickHandler=function(A){A.data.isMobile=false;A.data.showCashbackTermsAndConditions=false;if(CBA.Widgets.Constants.IS_CASHBACK_BUTTON_SHOWN){A.data.clickXPos=A.pageX;A.data.clickYPos=A.pageY;if(typeof (A.data.clickYPos)!="undefined"&&typeof (A.data.clickXPos)!="undefined"){if(CBA.Widgets.CheckoutWidget.prototype.isCashbackTermsLinkClicked.call(this,A)){CBA.Widgets.CheckoutWidget.prototype.onCashbackTermsAndConditionsClicked.call(this,A);return }}}CBA.Widgets.CheckoutWidget.prototype.onClickHandler.call(this,A)};CBA.Widgets.ExpressCheckoutWidget.prototype.submit=function(){CBA.jQuery(this).bind(CBA.Widgets.EventTypes.EXPRESS_CHK_ONAUTHORIZE,this,this.onAuthorizeEventHandler);var F=this.getPopupWindowName();var E=this.getID()+"Form";var D=window.top.location;var B=CBA.Widgets.Constants.WIDGET_ENDPOINT+CBA.Widgets.Constants.EXPRESS_CHECKOUT_URI;var A={action:"spc",referringURL:D,cartOwnerId:this.getMerchantId()};if(this.getPurchaseContractId()!=undefined){A.purchaseContractId=this.getPurchaseContractId()}if(this.shippingRestrictions!=undefined){var G=this.encodeShippingRestrictions();A.shippingRestrictions=G}var C=CBA.Widgets.Utilities.createFormString(E,B,F,A);CBA.jQuery("#"+E).remove();CBA.jQuery("#"+this.getLocation()).append(C);CBA.jQuery("#"+E).submit()};CBA.Widgets.InlineCheckoutWidget=function(A){CBA.Widgets.CheckoutWidget.call(this,A);this.onAuthorize=A.onAuthorize;this.onOpen=A.onOpen;this.authorizationToken=A.authorizationToken;this.type=CBA.Widgets.WidgetTypes.InlineCheckoutWidget;if(A.buttonType!=undefined&&A.buttonType==CBA.Widgets.ButtonTypes.INLINE_ADDRESS){this.buttonType=CBA.Widgets.ButtonTypes.INLINE_ADDRESS}else{this.buttonType=CBA.Widgets.ButtonTypes.INLINE_CHECKOUT}this.purchaseContractId=A.purchaseContractId;this.getPurchaseContractId=function(){return this.purchaseContractId}};CBA.Widgets.InlineCheckoutWidget.prototype=CBA.Widgets.createSubclass(CBA.Widgets.CheckoutWidget.prototype);CBA.Widgets.InlineCheckoutWidget.prototype.constructor=CBA.Widgets.InlineCheckoutWidget;CBA.Widgets.InlineCheckoutWidget.prototype.shouldSkipPopup=function(){return(this.purchaseContractId&&this.authorizationToken)};CBA.Widgets.InlineCheckoutWidget.prototype.onClickHandler=function(C){if(C.data.shouldSkipPopup()){if(typeof (C.data.onOpen)==="function"){C.data.onOpen(C.data)}else{C.data.submit()}}else{C.data.isMobile=false;C.data.showCashbackTermsAndConditions=false;if(CBA.Widgets.Constants.IS_CASHBACK_BUTTON_SHOWN){C.data.clickXPos=C.pageX;C.data.clickYPos=C.pageY;if(typeof (C.data.clickYPos)!="undefined"&&typeof (C.data.clickXPos)!="undefined"){var D=CBA.Widgets.CheckoutWidget.prototype.getClickRatios.call(this,C);var A=D[1];var B=D[0];if(CBA.Widgets.CheckoutWidget.prototype.isCashbackTermsLinkClicked.call(this,C)){CBA.Widgets.CheckoutWidget.prototype.onCashbackTermsAndConditionsClicked.call(this,C);return }}}CBA.Widgets.CheckoutWidget.prototype.onClickHandler.call(this,C)}};CBA.Widgets.InlineCheckoutWidget.prototype.delayedEventHandler=function(A,B){if(B!=null){if(B.closed==1){A.onAuthorize(A)}else{setTimeout(function(){CBA.Widgets.InlineCheckoutWidget.prototype.delayedEventHandler(A,B)},CBA.Widgets.Constants.TIMER_INTERVAL)}}};CBA.Widgets.InlineCheckoutWidget.prototype.onAuthorizeEventHandler=function(A){var B=A.data;if(!B.shouldSkipPopup()){B.purchaseContractId=B.eventValue}CBA.Widgets.Utilities.createCookie(CBA.Widgets.Constants.PURCHASE_CONTRACT_ID_COOKIE_NAME,B.purchaseContractId,CBA.Widgets.Constants.PURCHASE_CONTRACT_ID_COOKIE_LIFETIME);if(typeof (B.onAuthorize)==="function"){if(isIphone()){setTimeout(function(){CBA.Widgets.InlineCheckoutWidget.prototype.delayedEventHandler(B,A.data.popupWindow)},CBA.Widgets.Constants.TIMER_INTERVAL)}else{B.onAuthorize(B)}}CBA.jQuery(B).unbind(CBA.Widgets.EventTypes.EXPRESS_CHK_ONAUTHORIZE,B.onAuthorizeEventHandler)};CBA.Widgets.InlineCheckoutWidget.prototype.submit=function(){CBA.jQuery(this).bind(CBA.Widgets.EventTypes.EXPRESS_CHK_ONAUTHORIZE,this,this.onAuthorizeEventHandler);if(this.shouldSkipPopup()){CBA.jQuery(this).trigger(CBA.Widgets.EventTypes.EXPRESS_CHK_ONAUTHORIZE)}else{this.popupForm()}};CBA.Widgets.InlineCheckoutWidget.prototype.popupForm=function(){var F=this.getPopupWindowName();var E=this.getID()+"Form";var D=window.top.location;var B=CBA.Widgets.Constants.WIDGET_ENDPOINT+CBA.Widgets.Constants.INLINE_WIDGETS_URI;var A={action:"connect",referringURL:D,cartOwnerId:this.getMerchantId()};if(this.getPurchaseContractId()!=undefined){A.purchaseContractId=this.getPurchaseContractId()}var C=CBA.Widgets.Utilities.createFormString(E,B,F,A);CBA.jQuery("#"+E).remove();CBA.jQuery("#"+this.getLocation()).append(C);CBA.jQuery("#"+E).submit()};CBA.Widgets.Design=function(A){if(typeof (A)!="undefined"){this.name=A.name;this.colorTheme=A.colorTheme;if(A.size!=null){this.width=A.size.width;this.height=A.size.height}}};CBA.Widgets.InlineWidget=function(A){CBA.Widgets.Widget.call(this,A);this.purchaseContractId=A.purchaseContractId;var B=CBA.Widgets.DisplayModes.edit;if(typeof (A.displayMode)!="undefined"){if(A.displayMode.toLowerCase()===CBA.Widgets.DisplayModes.read.toLowerCase()){B=CBA.Widgets.DisplayModes.read}}var C=CBA.Widgets.PaymentInstrumentsDisplayOptions.Default;if(typeof (A.paymentInstrumentsDisplayOptions)!="undefined"){if(A.paymentInstrumentsDisplayOptions.toLowerCase()===CBA.Widgets.PaymentInstrumentsDisplayOptions.ShowAll.toLowerCase()){C=CBA.Widgets.PaymentInstrumentsDisplayOptions.ShowAll}}this.getDisplayMode=function(){return B};this.getPaymentInstrumentsDisplayOptions=function(){return C};this.design=new CBA.Widgets.Design(A.design);CBA.jQuery(this).bind(CBA.Widgets.EventTypes.REFRESH,this,this.refreshEventHandler);CBA.jQuery(this).bind(CBA.Widgets.EventTypes.WIDGET_REFRESH,this,this.widgetRefreshEventHandler)};CBA.Widgets.InlineWidget.prototype=CBA.Widgets.createSubclass(CBA.Widgets.Widget.prototype);CBA.Widgets.InlineWidget.prototype.constructor=CBA.Widgets.InlineWidget;CBA.Widgets.InlineWidget.Design=function(A){if(typeof (A)!="undefined"){this.name=A.name;this.colorTheme=A.colorTheme;if(A.size!=null){this.width=A.size.width;this.height=A.size.height}}};CBA.Widgets.InlineWidget.prototype.getPurchaseContractId=function(){var A=(typeof (this.purchaseContractId)!="undefined")?this.purchaseContractId:CBA.Widgets.Utilities.readCookie(CBA.Widgets.Constants.PURCHASE_CONTRACT_ID_COOKIE_NAME);return A};CBA.Widgets.InlineWidget.prototype.refreshEventHandler=function(){var A=this.getID()+"Form";CBA.jQuery("#"+A).submit()};CBA.Widgets.InlineWidget.prototype.widgetRefreshEventHandler=function(B){var C=B.data;var A=C.eventValue;if(this.getID()==A){this.refreshEventHandler()}};CBA.Widgets.WalletWidget=function(B){CBA.Widgets.InlineWidget.call(this,B);this.type=CBA.Widgets.WidgetTypes.WalletWidget;this.onPaymentSelect=B.onPaymentSelect;this.onErrorCallback=B.onErrorCallback;var C=this.design.width;var A=this.design.height;switch(this.getDisplayMode()){case CBA.Widgets.DisplayModes.read:this.design.width=CBA.Widgets.Utilities.verifySize(C,CBA.Widgets.Constants.WALLET_WIDGET.READ.default_width,CBA.Widgets.Constants.WALLET_WIDGET.READ.min_width,CBA.Widgets.Constants.WALLET_WIDGET.READ.max_width);this.design.height=CBA.Widgets.Utilities.verifySize(A,CBA.Widgets.Constants.WALLET_WIDGET.READ.default_height,CBA.Widgets.Constants.WALLET_WIDGET.READ.min_height,CBA.Widgets.Constants.WALLET_WIDGET.READ.max_height);break;case CBA.Widgets.DisplayModes.edit:this.design.width=CBA.Widgets.Utilities.verifySize(C,CBA.Widgets.Constants.WALLET_WIDGET.EDIT.default_width,CBA.Widgets.Constants.WALLET_WIDGET.EDIT.min_width,CBA.Widgets.Constants.WALLET_WIDGET.EDIT.max_width);this.design.height=CBA.Widgets.Utilities.verifySize(A,CBA.Widgets.Constants.WALLET_WIDGET.EDIT.default_height,CBA.Widgets.Constants.WALLET_WIDGET.EDIT.min_height,CBA.Widgets.Constants.WALLET_WIDGET.EDIT.max_height);break}CBA.jQuery(this).bind(CBA.Widgets.EventTypes.ON_PAYMENT_SELECT,this,this.onPaymentSelectHandler);CBA.jQuery(this).bind(CBA.Widgets.EventTypes.ON_ADDRESS_SELECT,this,this.onAddrSelectHandler);CBA.jQuery(this).bind(CBA.Widgets.EventTypes.ON_ERROR,this,CBA.Widgets.CheckoutWidget.prototype.onErrorCallbackHandler)};CBA.Widgets.WalletWidget.prototype=CBA.Widgets.createSubclass(CBA.Widgets.InlineWidget.prototype);CBA.Widgets.WalletWidget.prototype.constructor=CBA.Widgets.WalletWidget;CBA.Widgets.WalletWidget.prototype.onAddrSelectHandler=function(A){this.refreshEventHandler()};CBA.Widgets.WalletWidget.prototype.onPaymentSelectHandler=function(B){var C=B.data;var A=C.eventValue;if(this.getID()==A){if(this.onPaymentSelect!=undefined){this.onPaymentSelect(C)}}};CBA.Widgets.WalletWidget.prototype.renderElements=function(){var F=this.getID()+"IFrame";var C=CBA.Widgets.Utilities.createIFrameString(F,this.design.width,this.design.height);var E=this.getID()+"Form";var B=CBA.Widgets.Constants.WIDGET_ENDPOINT+CBA.Widgets.Constants.INLINE_WIDGETS_URI;var A={action:"walletWidget",referringURL:window.top.location,cartOwnerId:this.getMerchantId(),purchaseContractId:this.getPurchaseContractId(),displayMode:this.getDisplayMode(),widgetId:this.getID(),widgetWidth:this.design.width,widgetHeight:this.design.height,paymentInstrumentsDisplayOptions:this.getPaymentInstrumentsDisplayOptions()};var D=CBA.Widgets.Utilities.createFormString(E,B,F,A);CBA.jQuery("#"+E).remove();CBA.Widgets.Utilities.createWidgetContainer(this.locationID,this.getID(),this.design.width,this.design.height,C);CBA.Widgets.Utilities.createWidgetForm(this.locationID,this.getID(),this.design.width,this.design.height,D,E);CBA.jQuery("#"+E).submit()};CBA.Widgets.AddressWidget=function(B){CBA.Widgets.InlineWidget.call(this,B);this.type=CBA.Widgets.WidgetTypes.AddressWidget;this.onErrorCallback=B.onErrorCallback;var C=this.design.width;var A=this.design.height;switch(this.getDisplayMode()){case CBA.Widgets.DisplayModes.read:this.design.width=CBA.Widgets.Utilities.verifySize(C,CBA.Widgets.Constants.ADDRESS_WIDGET.READ.default_width,CBA.Widgets.Constants.ADDRESS_WIDGET.READ.min_width,CBA.Widgets.Constants.ADDRESS_WIDGET.READ.max_width);this.design.height=CBA.Widgets.Utilities.verifySize(A,CBA.Widgets.Constants.ADDRESS_WIDGET.READ.default_height,CBA.Widgets.Constants.ADDRESS_WIDGET.READ.min_height,CBA.Widgets.Constants.ADDRESS_WIDGET.READ.max_height);break;case CBA.Widgets.DisplayModes.edit:this.design.width=CBA.Widgets.Utilities.verifySize(C,CBA.Widgets.Constants.ADDRESS_WIDGET.EDIT.default_width,CBA.Widgets.Constants.ADDRESS_WIDGET.EDIT.min_width,CBA.Widgets.Constants.ADDRESS_WIDGET.EDIT.max_width);this.design.height=CBA.Widgets.Utilities.verifySize(A,CBA.Widgets.Constants.ADDRESS_WIDGET.EDIT.default_height,CBA.Widgets.Constants.ADDRESS_WIDGET.EDIT.min_height,CBA.Widgets.Constants.ADDRESS_WIDGET.EDIT.max_height);break}this.onAddressSelect=B.onAddressSelect;this.shippingRestrictions=B.shippingRestrictions;this.getDestinationName=function(){return B.destinationName};CBA.jQuery(this).bind(CBA.Widgets.EventTypes.ON_ERROR,this,CBA.Widgets.CheckoutWidget.prototype.onErrorCallbackHandler);CBA.jQuery(this).bind(CBA.Widgets.EventTypes.ON_ADDRESS_SELECT,this,this.onAddrSelectHandler)};CBA.Widgets.AddressWidget.prototype=CBA.Widgets.createSubclass(CBA.Widgets.InlineWidget.prototype);CBA.Widgets.AddressWidget.prototype.constructor=CBA.Widgets.AddressWidget;CBA.Widgets.AddressWidget.prototype.onAddrSelectHandler=function(B){var C=B.data;var A=C.eventValue;if(this.getID()==A){if(this.onAddressSelect!=undefined){this.onAddressSelect(C)}}};CBA.Widgets.AddressWidget.prototype.renderElements=function(){var G=this.getID()+"IFrame";var C=CBA.Widgets.Utilities.createIFrameString(G,this.design.width,this.design.height);var E=this.getID()+"Form";var B=CBA.Widgets.Constants.WIDGET_ENDPOINT+CBA.Widgets.Constants.INLINE_WIDGETS_URI;var A={action:"addressWidget",referringURL:window.top.location,cartOwnerId:this.getMerchantId(),purchaseContractId:this.getPurchaseContractId(),displayMode:this.getDisplayMode(),widgetId:this.getID(),widgetWidth:this.design.width,widgetHeight:this.design.height};if(this.shippingRestrictions!=undefined){var F=this.encodeShippingRestrictions();A.shippingRestrictions=F}if(this.getDestinationName()!=undefined){A.destinationName=this.getDestinationName()}var D=CBA.Widgets.Utilities.createFormString(E,B,G,A);CBA.jQuery("#"+E).remove();CBA.Widgets.Utilities.createWidgetContainer(this.locationID,this.getID(),this.design.width,this.design.height,C);CBA.Widgets.Utilities.createWidgetForm(this.locationID,this.getID(),this.design.width,this.design.height,D,E);CBA.jQuery("#"+E).submit()};CBA.Widgets.OrderDetailsWidget=function(A){CBA.Widgets.InlineWidget.call(this,A);this.type=CBA.Widgets.WidgetTypes.OrderDetailsWidget;this.orderId=A.orderID;CBA.jQuery(this).bind(CBA.Widgets.EventTypes.ON_CLOSE,this,this.closeEventHandler)};CBA.Widgets.OrderDetailsWidget.prototype=CBA.Widgets.createSubclass(CBA.Widgets.InlineWidget.prototype);CBA.Widgets.OrderDetailsWidget.prototype.constructor=CBA.Widgets.OrderDetailsWidget;CBA.Widgets.OrderDetailsWidget.prototype.renderElements=function(){var C=this.design.width;var B=this.design.height;this.design.width=CBA.Widgets.Utilities.verifySize(C,CBA.Widgets.Constants.ORDER_DETAIL_WIDGET.RENDER.default_width,CBA.Widgets.Constants.ORDER_DETAIL_WIDGET.RENDER.min_width,CBA.Widgets.Constants.ORDER_DETAIL_WIDGET.RENDER.max_width);this.design.height=CBA.Widgets.Utilities.verifySize(B,CBA.Widgets.Constants.ORDER_DETAIL_WIDGET.RENDER.default_height,CBA.Widgets.Constants.ORDER_DETAIL_WIDGET.RENDER.min_height,CBA.Widgets.Constants.ORDER_DETAIL_WIDGET.RENDER.max_height);var H=this.getID()+"IFrame";var E=CBA.Widgets.Utilities.createIFrameString(H,this.design.width,this.design.height);var G=this.getID()+"Form";var D=CBA.Widgets.Constants.WIDGET_ENDPOINT+CBA.Widgets.Constants.INLINE_WIDGETS_URI;var A={action:"orderReviewWidget",referringURL:window.top.location,widgetId:this.getID(),widgetWidth:this.design.width,widgetHeight:this.design.height,orderId:this.orderId,userAction:"Render"};var F=CBA.Widgets.Utilities.createFormString(G,D,H,A);CBA.jQuery("#"+G).remove();CBA.Widgets.Utilities.createWidgetContainer(this.locationID,this.getID(),this.design.width,this.design.height,E+F);CBA.Widgets.Utilities.createWidgetForm(this.locationID,this.getID(),this.design.width,this.design.height,F,G);CBA.jQuery("#"+G).submit()};CBA.Widgets.OrderDetailsWidget.prototype.open=function(L,F){var C=this.design.width;var M=this.design.height;this.design.width=CBA.Widgets.Utilities.verifySize(C,CBA.Widgets.Constants.ORDER_DETAIL_WIDGET.OPEN.default_width,CBA.Widgets.Constants.ORDER_DETAIL_WIDGET.OPEN.min_width,CBA.Widgets.Constants.ORDER_DETAIL_WIDGET.OPEN.max_width);this.design.height=CBA.Widgets.Utilities.verifySize(M,CBA.Widgets.Constants.ORDER_DETAIL_WIDGET.OPEN.default_height,CBA.Widgets.Constants.ORDER_DETAIL_WIDGET.OPEN.min_height,CBA.Widgets.Constants.ORDER_DETAIL_WIDGET.OPEN.max_height);var G="CBA.jQuery('body').css('cursor', 'auto');";var B=this.getID()+"IFrame";var I=CBA.Widgets.Utilities.createIFrameString(B,this.design.width,this.design.height);var K=this.getID()+"Form";var H=CBA.Widgets.Constants.WIDGET_ENDPOINT+CBA.Widgets.Constants.INLINE_WIDGETS_URI;var A={action:"orderReviewWidget",referringURL:window.top.location,widgetId:this.getID(),widgetWidth:this.design.width,widgetHeight:this.design.height,orderId:this.orderId,userAction:"Open"};var E=CBA.Widgets.Utilities.createFormString(K,H,B,A);var J=this.getID()+"_popupdiv";var D="<div id='"+J+"' style='z-index: 90000; position: absolute; left: "+F+"; top: "+L+";'></div>";CBA.jQuery("#"+J).remove();CBA.jQuery(D).appendTo(document.body);CBA.Widgets.Utilities.createWidgetContainer(J,this.getID(),this.design.width,this.design.height,I+E);CBA.jQuery("#"+K).submit()};CBA.Widgets.OrderDetailsWidget.prototype.closeEventHandler=function(C){var D=C.data;var B=D.eventValue;var A=this.getID()+"_popupdiv";if(this.getID()==B){CBA.jQuery("#"+A).remove()}};CBA.Widgets.PrimeWidget=function(B){CBA.Widgets.CheckoutWidget.call(this,B);var C=B.orderInput;this.getOrderInput=function(){return C};var E=B.customerID;this.getCustomerID=function(){return E};var D=B.primeSettings||{},A=D.orientation||"";this.getOrientation=function(){return A};CBA.jQuery(this).bind(CBA.Widgets.EventTypes.PRIME_WIDGET_RESIZE,this,this.onResizeEventHandler)};CBA.Widgets.PrimeWidget.prototype=CBA.Widgets.createSubclass(CBA.Widgets.CheckoutWidget.prototype);CBA.Widgets.PrimeWidget.prototype.constructor=CBA.Widgets.PrimeWidget;CBA.Widgets.PrimeWidget.Constants={ORIENTATION_HORIZONTAL:"horizontal",ORIENTATION_VERTICAL:"vertical"};CBA.Widgets.PrimeWidget.prototype.getContainerID=function(){return this.containerID};CBA.Widgets.PrimeWidget.prototype.setContainerID=function(A){this.containerID=A};CBA.Widgets.PrimeWidget.prototype.getContainer=function(){return this.container};CBA.Widgets.PrimeWidget.prototype.setContainer=function(A){this.container=A};CBA.Widgets.PrimeWidget.prototype.getIFrame=function(){return this.iframe};CBA.Widgets.PrimeWidget.prototype.setIFrame=function(A){this.iframe=A};CBA.Widgets.PrimeWidget.prototype.onResizeEventHandler=function(D,E){var C=D.data.eventValue.widgetID,A=D.data.eventValue.height,B=D.data.eventValue.width;if(C==this.getContainerID()){this.resizeIFrame(A,B)}};CBA.Widgets.PrimeWidget.prototype.render=function(E){var F=this.getOrientation().toLowerCase();if(F!=CBA.Widgets.PrimeWidget.Constants.ORIENTATION_HORIZONTAL&&F!=CBA.Widgets.PrimeWidget.Constants.ORIENTATION_VERTICAL){return this}var D=document.getElementById(E);if(D==null){return this}this.setContainerID(E);this.setContainer(D);while(D.firstChild){D.removeChild(D.firstChild)}var I=this.getOrderInput(),M=I.format,P=I.value;if("html"==M.toLowerCase()){var B=[];for(var N=0,G=inputs.length;N<G;++N){var O=inputs[N];B.push(encodeURIComponent(O.name)+"="+encodeURIComponent(O.value))}P=B.join("&")}var C=this.getID()+"IFrame",K=this.getID()+"Form",L=CBA.Widgets.Utilities.createIFrameString(C,"100%","0"),H=CBA.Widgets.Constants.BUTTON_ENDPOINT+CBA.Widgets.Constants.PRIME_WIDGETS_URI;var A={merchantId:this.getMerchantId(),orientation:this.getOrientation(),containerID:this.getContainerID(),referringURL:window.top.location,orderInputFormat:M,orderInput:P};var Q=CBA.Widgets.Utilities.createFormString(K,H,C,A);CBA.jQuery("#"+this.getContainerID()).html(L);CBA.jQuery(document.body).append(Q);CBA.jQuery("#"+K).submit();var J=CBA.jQuery("#"+C).get(0);J.style.border="none";J.style.margin="0";J.style.padding="0";J.style.backgroundColor="transparent";J.style.overflow="hidden";J.allowTransparency=true;J.scrolling="no";J.frameBorder="0";this.setIFrame(J);CBA.jQuery("#"+K).remove()};CBA.Widgets.PrimeWidget.prototype.resizeIFrame=function(A,D){var C=this.getIFrame(),B=this.getContainer();C.style.height=A;C.style.width=D;B.style.height=A;B.style.width=D};CBA.Widgets.PrimeWidget.parseResizeMessage=function(K,I){var F=K.indexOf(CBA.Widgets.EventTypes.PRIME_WIDGET_RESIZE,0),D=K.substring(F+CBA.Widgets.EventTypes.PRIME_WIDGET_RESIZE.length),B=D.split(";"),J=B.shift();I.eventValue={};I.eventValue.widgetID=J;for(var E=0,A=B.length;E<A;E++){var G=B[E].split("="),C=G.shift(),H=decodeURIComponent(G.join("="));I.eventValue[C]=H}};CBA.Widgets.mainCollector.registerTime("js-loading","js-loaded")}