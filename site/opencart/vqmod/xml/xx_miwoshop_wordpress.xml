<modification>
    <id>MiwoShop - Wordpress</id>
    <version>1.0.0</version>
    <vqmver>1.0.0</vqmver>
    <author>miwisoft.com</author>

    <file name="catalog/model/account/customer.php">
   		<operation error="skip">
   			<search position="replace"><![CDATA[MiwoShop::get('user')->updateJUserPasswordFromO($email, $password);]]></search>
   			<add><![CDATA[$encrypted_password = MiwoShop::get('user')->updateJUserPasswordFromO($email, $password);]]></add>
   		</operation>
        <operation error="skip">
            <search position="replace"><![CDATA[$this->db->query("UPDATE " . DB_PREFIX . "customer SET salt = '" . $this->db->escape($salt = substr(md5(uniqid(rand(), true)), 0, 9)) . "', password = '" . $this->db->escape(sha1($salt . sha1($salt . sha1($password)))) . "' WHERE LOWER(email) = '" . $this->db->escape(utf8_strtolower($email)) . "'");]]></search>
            <add><![CDATA[$this->db->query("UPDATE " . DB_PREFIX . "customer SET salt = '', password = '" . $encrypted_password . "' WHERE LOWER(email) = '" . $this->db->escape(utf8_strtolower($email)) . "'");]]></add>
        </operation>
   	</file>

    <file name="admin/model/sale/customer.php">
   		<operation error="skip">
   			<search position="replace"><![CDATA[$data['password'] = MiwoShop::get('user')->updateJUserFromO(MiwoShop::get('user')->getJUserIdFromOCustomer($customer_id), $data, $customer_id);]]></search>
   			<add><![CDATA[
        if($data['password']) {
            $data['password'] = MiwoShop::get('user')->encryptPassword($data['password']);
        }

        MiwoShop::get('user')->updateJUserFromO(MiwoShop::get('user')->getJUserIdFromOCustomer($customer_id), $data, $customer_id);
        ]]></add>
   		</operation>
   	</file>
	
	<file name="system/library/session.php">
		<operation error="skip">
            <search position="replace" offset="8"><![CDATA[if (!session_id()) {]]></search>
            <add><![CDATA[MFactory::getSession();]]></add>
        </operation>
    </file>

</modification>